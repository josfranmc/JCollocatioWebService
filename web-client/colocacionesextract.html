<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>JCollocatioWebService - Extract</title>
  </head>
  <body>
	<div class="jumbotron text-center" style="margin-bottom:0">
	  <h1>Colocaciones - extracción</h1>
	  <p>Permite aplicar un algoritmo para la extracción de colocaciones en base a un corpus textual</p> 
	</div>

	<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	  <a class="navbar-brand" href="index.html">Menú</a>
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		<span class="navbar-toggler-icon"></span>
	  </button>
	  <div class="collapse navbar-collapse" id="collapsibleNavbar">
		<ul class="navbar-nav">
			<!-- Dropdown -->
			<li class="nav-item dropdown">
			  <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
				Corpus
			  </a>
			  <div class="dropdown-menu">
				<a class="dropdown-item" href="downloads.html">Descarga de textos</a>
				<a class="dropdown-item" href="catalog.html">Consulta catálogo de libros Gutenberg</a>
			  </div>
			</li>			  
			<!-- Dropdown -->
			<li class="nav-item dropdown">
			  <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
				Colocaciones
			  </a>
			  <div class="dropdown-menu">
				<a class="dropdown-item" href="#">Extracción</a>
				<a class="dropdown-item" href="colocacionesquery.html">Consulta</a>
				<a class="dropdown-item" href="colocacionesadd.html">Añadir</a>
				<a class="dropdown-item" href="colocacionesdelete.html">Eliminar</a>
			  </div>
			</li>		  		  
		</ul>
	  </div>  
	</nav>			

	<div class="container" style="margin-top:30px;margin-bottom:30px">

	  <div class="row">
			<div class="col-sm-4"></div>
			<div class="col-sm-4 text-center">
				<div class="form-group">
				  <label for="url">Url:</label>
				  <input class="form-control" id="url" placeholder="URL del servicio web" name="url">
				</div>
			</div>
			<div class="col-sm-4"></div>
	  </div>	
	  <div class="row">
		<div class="col-sm-12 text-center"><h2 style="margin-top:15px;margin-bottom:25px;">Parámetros algoritmo</h2></div>
	  </div>	  
	  <div class="row">
		<div class="col-sm-6">
			<div class="form-group">
			  <label for="algorithmType">Algoritmo:</label>
			  <select name="algorithmType" id="algorithmType" class="custom-select mb-3">
				<option selected value="MUTUAL_INFORMATION">MUTUAL_INFORMATION</option>
				<option value="ANOTHER_ALGORITHM">ANOTHER_ALGORITHM</option>
			  </select>
			</div>				
			<div class="form-group">
			  <label for="triplesFilter">Filtro:</label>
			  <input class="form-control" id="triplesFilter" name="triplesFilter">
			</div>
			<div class="form-group">
			  <label for="textsPathToProcess">Ruta ficheros a analizar:</label>
			  <input class="form-control" id="textsPathToProcess" name="textsPathToProcess">
			</div>			
			<div class="form-group">
			  <label for="adjustedFrequency">Ajuste de frecuencia:</label>
			  <input class="form-control" id="adjustedFrequency" name="adjustedFrequency" value="0">
			</div>
			<div class="form-group">
			  <label for="newDataBase">Nombre nueva base de datos:</label>
			  <input class="form-control" id="newDataBase" name="newDataBase">
			</div>
			<div class="form-group">
			  <label for="newDataBaseDescription">Descripción:</label>
			  <input class="form-control" id="newDataBaseDescription" name="newDataBaseDescription">
			</div>
			<div class="form-group">
			  <label for="totalThreads">Total hilos:</label>
			  <input class="form-control" id="totalThreads" name="totalThreads" value="4">
			</div>
		</div>
		<div class="col-sm-6">
			<div class="form-group">
			  <label for="model">Analizador (model) Stanford:</label>
			  <input class="form-control" id="model" name="model" value="edu/stanford/nlp/models/lexparser/englishPCFG.ser.gz">
			</div>	
			<div class="form-group">
			  <label for="lenSentence">Longitud máxima de oración a analizar:</label>
			  <input class="form-control" id="lenSentence" name="lenSentence" value="35">
			</div>			
		</div>
	  </div>
	</div>	

	<div class="row">
		<div class="col-sm-4"></div>
		<div class="col-sm-4">
			<div class="text-center">
				<button id="btn-submit" class="btn btn-primary">Submit</button>
			</div>
		</div>
		<div class="col-sm-4"></div>
	</div>	
	<div class="row">
		<div class="col-sm-4"></div>
		<div class="col-sm-4">
			<div id="response" class="border" style="margin-top:10px;margin-bottom:40px;padding-left:10px"></div>
		</div>
		<div class="col-sm-4"></div>
	</div>	
	
	<div class="jumbotron text-center" style="margin-bottom:0">
	  <p>PFG Extracción de colocaciones</p>
	</div>	
	
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	
	<script>
	
	$(document).ready(function(){

		function showResponse(respuesta) {
			$('#response').html('<p><b>error:</b> ' + respuesta.error + '</p>');
			$('#response').append('<p><b>status:</b> ' + respuesta.status + '</p>');
			$('#response').append('<p><b>message:</b> ' + respuesta.message + '</p>');
			$('#response').append('<p><b>path:</b> ' + respuesta.path + '</p>');
			$('#response').append('<p><b>timestamp:</b> ' + respuesta.timestamp + '</p>');			
		}
		
		
		function getFilter() {
			var filter;
			if ($('#triplesFilter').val() == "") {
				filter = [ ];
			} else {
				filter = $('#triplesFilter').val().split(',');
			}
			return filter;
		}

		
		$('#btn-submit').click(function(){
		    $('#response').html('<p>Procesando petición....</p>');

			if ($('#triplesFilter').val() == "") {
				var filter = [ ];
			} else {
				var filter = $('#triplesFilter').val().split(',');
			}
			
			var datos = {"algorithmType": $('#algorithmType').val(),
						 "triplesFilter": getFilter(),
			             "textsPathToProcess": $('#textsPathToProcess').val(),
			             "adjustedFrequency": $('#adjustedFrequency').val(),
			             "totalThreads": $('#totalThreads').val(), 
						 "model": $('#model').val(),
						 "stanfordOptions": {
							"-maxLength": $('#lenSentence').val(),
							"-retainTmpSubcategories": null
						 },					 
			             "newDataBase": $('#newDataBase').val(),
			             "newDataBaseDescription": $('#newDataBaseDescription').val()
						};

			var direccion = $('#url').val();

			$.ajax({
				url: direccion,
				data: JSON.stringify(datos),
				type: 'POST',
				dataType: 'json',
				contentType: 'application/json',
				
				success: function(respuesta, status, jqXHR ) {
					showResponse(respuesta);
				},
				
				error: function(jqXHR, status, errorThrown) {
					console.log("No se ha podido obtener la información. " + status + "   " + errorThrown);
					if (status != 'parsererror') {
						showResponse(JSON.parse(jqXHR.responseText));
					} else {
						$('#response').html('<p><b>error:</b> ' + status + '. ' + errorThrown + '</p>');
					}
				}
			});
		});
		
		
		$("#algorithmType").change(function(){
		console.log($('#algorithmType').val());
			if ($("#downloadMode").val() == 'GREEDY') {
				$("#delay").hide();
			} else {
				$("#delay").show();
			}
		});
	});	

	</script>	
	
  </body>
</html>